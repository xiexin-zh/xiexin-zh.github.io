{"version":3,"sources":["assets/images/txm.jpg","scripts/views/bookrepay/index.js"],"names":["module","exports","RepayBook","connect","state","borrowlist","getIn","searchBook","val","readertel","value","console","log","length","props","dispatch","getBorrowBook","url","params","then","res","setState","detail","failToast","txm","require","tipMsg","this","setBorrowBook","className","title","showBack","marqueeProps","loop","style","padding","src","alt","ref","el","autoHeight","required","labelNumber","onClick","map","list","i","key","SearchList","Component","reduce","borrowcount","add","num","repayBook","bookid","borrowid","backcount","bookRepay","readername","bookname","width","height","fontSize","marginRight","display","textAlign","descval","border","disabled","type","count","onChange","v","marginLeft","addval","_id"],"mappings":"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","file":"static/js/21.d4ef1ec1.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/txm.194a3bd4.jpg\";","\r\nimport './index.scss'\r\nimport Head from '~/components/Head'\r\nimport { NoticeBar, Icon, List, TextareaItem, Stepper, PickerView, Picker, Button } from 'antd-mobile';\r\nimport { connect } from 'react-redux'\r\nimport { failToast } from '&/methods'\r\nimport { getBorrowBook, setBorrowBook, bookRepay } from '../../actions';\r\n\r\n@connect(\r\n  state => {\r\n    return {\r\n      borrowlist: state.getIn(['data', 'borrowlist'])\r\n    }\r\n  }\r\n)\r\n\r\n\r\nexport default class RepayBook extends Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      txm: require('@/assets/images/txm.jpg'),\r\n      detail: false,\r\n      tipMsg: '请输入书籍编号查询...',\r\n    }\r\n  }\r\n\r\n  //通过手机号查询借书记录\r\n  searchBook = () => {\r\n    var val = this.readertel.state.value;\r\n    console.log(val)\r\n    if (val.length == 0) {\r\n      failToast('请输入手机号', 0.8);\r\n      return;\r\n    }\r\n    this.props.dispatch(getBorrowBook({\r\n      url: '/bookstore/getBorrowBook',\r\n      params: {\r\n        readertel: val\r\n      }\r\n    })).then(res => {\r\n      if (this.props.borrowlist.length > 0) {\r\n        this.setState({\r\n          detail: true\r\n        })\r\n      } else {\r\n        this.setState({\r\n          detail: false\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  componentDidMount() {\r\n    /* var val = this.readertel.state.value;\r\n    this.props.dispatch(getBorrowBook({\r\n      url: '/bookstore/getBorrowBook',\r\n      params: {\r\n        readertel: val\r\n      }\r\n    })).then(res => {\r\n      if (this.props.borrowlist.length > 0) {\r\n        this.setState({\r\n          detail: true\r\n        })\r\n      } else {\r\n        this.setState({\r\n          detail: false\r\n        })\r\n      }\r\n    }) */\r\n\r\n    this.props.dispatch(setBorrowBook)\r\n\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className='bookrepay'>\r\n        <Head title='还书管理' showBack={true}></Head>\r\n        <div>\r\n          <NoticeBar marqueeProps={{ loop: true, style: { padding: '0 7.5px' } }}>\r\n            注意：请如实填写以下信息。\r\n          </NoticeBar>\r\n        </div>\r\n        <div className='repaybox'>\r\n          <div className='txm'>\r\n            <div className='sys'>\r\n              <img src={this.state.txm} alt=\"\" />\r\n              <div className='search'>\r\n                <span className='iconfont icon-tubiaozhizuomoban'></span>\r\n              </div>\r\n            </div>\r\n            <p>点击扫码还书</p>\r\n          </div>\r\n          <div className='searchbook'>\r\n            <List className='booksearch'>\r\n              <TextareaItem\r\n                ref={el => this.readertel = el}\r\n                title=\"手机号：\"\r\n                autoHeight\r\n                required\r\n                labelNumber={5}\r\n\r\n              />\r\n            </List>\r\n            <div className='searchBtn'>\r\n              <p>请输入手机号进行搜索</p>\r\n              <span onClick={this.searchBook} className='iconfont icon-sousuo'></span>\r\n            </div>\r\n          </div>\r\n\r\n          {!this.props.borrowlist.length == 0 &&\r\n            this.props.borrowlist.map((list, i) => {\r\n              return (\r\n                <div key={i} className='searchlist'>\r\n                  <SearchList list={list} dispatch={this.props.dispatch}></SearchList>\r\n                </div>\r\n              )\r\n            })\r\n          }\r\n          {this.props.borrowlist == 0 && <div className='errorTip'>\r\n            没有搜索到借书记录\r\n          </div>}\r\n\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n\r\n\r\nexport class SearchList extends Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      borrowcount: 1,\r\n      num: 3\r\n    }\r\n  }\r\n\r\n  reduce = () => {\r\n    if (this.state.borrowcount <= 1) {\r\n      return\r\n    }\r\n    this.setState({\r\n      borrowcount: --this.state.borrowcount\r\n    })\r\n  }\r\n\r\n  add = () => {\r\n    if (this.state.borrowcount >= this.state.num) {\r\n      return\r\n    }\r\n    this.setState({\r\n      borrowcount: ++this.state.borrowcount\r\n    })\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({\r\n      num: this.props.list.num\r\n    })\r\n  }\r\n\r\n  //归还\r\n  repayBook = (bookid, readertel, num,borrowid) => {\r\n    var backcount = this.state.borrowcount;\r\n    // console.log(bookid, readertel, num, backcount);\r\n    this.props.dispatch(bookRepay({\r\n      url: '/bookstore/bookRepay',\r\n      params: {\r\n        readertel, bookid, backcount, num,borrowid\r\n      }\r\n    })).then(res => {\r\n      this.props.dispatch(getBorrowBook({\r\n        url: '/bookstore/getBorrowBook',\r\n        params: {\r\n          readertel\r\n        }\r\n      }))\r\n    })\r\n  }\r\n\r\n\r\n  render() {\r\n    const { borrowcount, num } = this.state;\r\n    const { list } = this.props;\r\n    return (\r\n      <div className='resultlist'>\r\n        <div className='r_box'>\r\n\r\n          <div className='readerinfo'>\r\n            <p><span className='spansty'>{list.readername}</span><span className='spansty'>{list.readertel}</span></p>\r\n          </div>\r\n          <div className='bookinfo'>\r\n            <p><span className='spansty'>{list.bookname}</span><span className='spansty'>{list.bookid}</span></p>\r\n          </div>\r\n          <div className='bookinfo'>\r\n            <p><span className='spansty'>借书数量</span><span className='spansty'>{list.num}</span></p>\r\n          </div>\r\n          <div className='borrowcount'>\r\n            <div className='spansty'>还书数量</div>\r\n            <div className='spansty'>\r\n              <span style={{ width: '20px', height: '20px', fontSize: '20px', marginRight: '5px', display: 'inline-block', textAlign: 'left' }} onClick={this.reduce} ref={el => this.descval = el}>-</span>\r\n              <input style={{ width: '40px', border: '0', textAlign: 'center' }} disabled value={borrowcount} type=\"number\" ref={el => this.count = el} onChange={v => { this.setState({ borrowcount: v }) }} />\r\n              <span style={{ width: '40px', height: '20px', fontSize: '20px', marginLeft: '5px', display: 'inline-block', textAlign: 'center' }} onClick={this.add} ref={el => this.addval = el}>+</span>\r\n            </div>\r\n          </div>\r\n          <div className='repayBtn'>\r\n            <Button className='btn' onClick={() => this.repayBook(list.bookid, list.readertel, list.num,list._id)}>归还</Button>\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}"],"sourceRoot":""}